<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Annotator</title>
</head>
<body>
    <h2 id="rowTitle">CSV Row Annotator</h2>
    
    <div id="rowDisplay"></div>
    
    <label for="quality">Quality:</label>
    <select id="quality">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select>
    
    <br><br>
    <button onclick="prevRow()">Previous</button>
    <button onclick="nextRow()">Next</button>
    <button onclick="submitToFormspree()">Submit Annotations</button>

    <script>
        let rows = [];
        let headers = [];
        let currentIndex = 0;
        let annotations = {};

        // Automatically load CSV when the page loads
        window.onload = function() {
            fetch("annotations.csv")
                .then(response => response.text())
                .then(text => {
                    let lines = text.trim().split("\n").map(row => row.split(","));
                    headers = lines[0].slice(0, 3); // First three columns only
                    rows = lines.slice(1).map(row => row.slice(0, 3)); // Keep only first three columns
                    displayRow();
                })
                .catch(error => console.error("Error loading CSV:", error));
        };

        function displayRow() {
            if (currentIndex < 0) currentIndex = 0;
            if (currentIndex >= rows.length) currentIndex = rows.length - 1;

            if (rows.length > 0 && rows[currentIndex]) {
                let rowData = rows[currentIndex];

                // Set title using the ID field (first column)
                document.getElementById("rowTitle").innerText = `Annotating: ${rowData[0]}`;

                // Display row data with headers
                let displayHTML = headers.map((header, i) => `<strong>${header}:</strong> ${rowData[i]}`).join("<br>");
                document.getElementById("rowDisplay").innerHTML = displayHTML;
            }

            // Load previous annotation if exists
            document.getElementById("quality").value = annotations[currentIndex] || "1";
        }

        function nextRow() {
            saveAnnotation();
            if (currentIndex < rows.length - 1) {
                currentIndex++;
                displayRow();
            }
        }

        function prevRow() {
            saveAnnotation();
            if (currentIndex > 0) {
                currentIndex--;
                displayRow();
            }
        }

        function saveAnnotation() {
            annotations[currentIndex] = document.getElementById("quality").value;
        }

        function submitToFormspree() {
            saveAnnotation();
            let formData = new FormData();
            formData.append("annotations", JSON.stringify(annotations));

            fetch("https://formspree.io/f/movjwzvr", {
                method: "POST",
                body: formData
            }).then(response => {
                if (response.ok) {
                    alert("Annotations submitted successfully!");
                } else {
                    alert("Error submitting annotations.");
                }
            });
        }
    </script>
</body>
</html>
