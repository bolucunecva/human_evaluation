<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Annotator</title>
</head>
<body>
    <h2>CSV Row Annotator</h2>
    <input type="file" id="csvFile" accept=".csv">
    <div id="rowDisplay"></div>
    <label for="quality">Quality:</label>
    <select id="quality">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select>
    <br><br>
    <button onclick="prevRow()">Previous</button>
    <button onclick="nextRow()">Next</button>
    <button onclick="downloadAnnotations()">Download Annotations</button>

    <script>
        let rows = [];
        let currentIndex = 0;
        let annotations = {};

        document.getElementById('csvFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const text = e.target.result;
                rows = text.split('\n').map(row => row.split(','));
                displayRow();
            };
            
            reader.readAsText(file);
        });

        function displayRow() {
            if (currentIndex < 0) currentIndex = 0;
            if (currentIndex >= rows.length) currentIndex = rows.length - 1;
            
            document.getElementById('rowDisplay').innerHTML = `<strong>Row ${currentIndex + 1}:</strong> ` + rows[currentIndex].join(', ');
            document.getElementById('quality').value = annotations[currentIndex] || "1";
        }

        function nextRow() {
            saveAnnotation();
            if (currentIndex < rows.length - 1) {
                currentIndex++;
                displayRow();
            }
        }

        function prevRow() {
            saveAnnotation();
            if (currentIndex > 0) {
                currentIndex--;
                displayRow();
            }
        }

        function saveAnnotation() {
            annotations[currentIndex] = document.getElementById('quality').value;
        }

        function downloadAnnotations() {
            let csvContent = "data:text/csv;charset=utf-8,Row,Quality\n";
            for (let i = 0; i < rows.length; i++) {
                csvContent += rows[i].join(',') + ',' + (annotations[i] || "1") + "\n";
            }
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "annotations.csv");
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>
</html>

